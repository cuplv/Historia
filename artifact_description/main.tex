\documentclass{acmart} %\settopmatter{printfolios=true,printccs=false,printacmref=false} % full template

%%%%%% optimizations for build speed and review



%%%%%%
%%To turn off red line numbers, use documentclass without "review"
%\documentclass[acmsmall,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}

%%% Packages
\usepackage[nosubfig,nographicx,nonatbib,noxcolor,nohyperref,notheoremenvs]{bec}
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n} %supress asmmath font warning
\setboolean{showjedi}{false}
\setboolean{showcomments}{true} % turn off todo comments too
\usepackage{tikz} 
\usetikzlibrary{automata, positioning,arrows,arrows.meta,fit}
\usepackage{multirow}
\usepackage{setspace} % for "\setstretch" macro used by specbox
\usepackage{empheq}
\usepackage[clock]{ifsym}

% booleans to turn off individual sections
\newcommand{\inputsection}[1]{\ifthenelse{\boolean{#1}}{\input{#1}}{\TODO{====== temp exclusion section #1 for build =======}}}



%%
%% \BibTeX command to typeset BibTeX logo in the docs
%\AtBeginDocument{%
%  \providecommand\BibTeX{{%
%    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
%%
%% These commands are for a JOURNAL article.
%\renewcommand{\reftxt}[2]{\hyperref[#2]{#1~\ref*{#2}}}
%\renewcommand{\lineref}[1]{\reftxt{line}{line:#1}} 
%\newcommand{\refprog}[1]{\reftxt{location}{#1}}
%\newcommand{\refhistimp}[1]{\reftxt{History Implication}{#1}}

% hyperref options
\def\sectionautorefname{Section}
\def\subsectionautorefname{Section}
\def\subsubsectionautorefname{Section}

\bibliographystyle{ACM-Reference-Format}
%\citestyle{acmauthoryear}

%%%%double spacing for hand review
%%% also comment out 3200 through 3204 in acmart.cls (enforces no messing with line spacing)
%\usepackage{setspace}
%\doublespacing % put after document
%%%%%%%%%


\begin{document}

\input{macros}
%\newcommand{\plusmini}{\scalebox{0.8}{$+$}}
%\newcommand{\minusmini}{\scalebox{0.8}{$-$}}
%\newcommand{\expos}{\ensuremath{\SetName{Ex}^{\plusmini}}}
%\newcommand{\exneg}{\ensuremath{\SetName{Ex}^{\minusmini}}}
\newcommand{\newls}{CBCFTL\xspace}
%\newcommand{\ignore}[1]{}
%
\title{Artifact - Historia: Refuting Callback Reachability with Message-History Logics}

\begin{abstract}
\end{abstract}


\maketitle
%\input{generated/specMacros}
\section{Introduction}
This document explains the artifact for the Historia paper \cite{conf/oopsla/Meier23}.
The goal of this document is to first give a set of instructions for reproducing the experimental results and then give a technical explanation of how the implementation connects to the technical contributions.
For inputs, this artifact takes a compiled Android application in the form of an \codej{APK} file, a location in the application for the assertion, and a \newls specification of realizable message histories.
Outputs are either ``safe'' or ``alarm'' in which case an abstract message history witnessing the alarm will be available.

\section{Prerequisites - Running the Historia Docker Container}

We have configured the experiments to be run within a Docker container provided with this artifact.
This Docker file may be found in the root directory of this archive and is labeled \codej{historia.docker}.  Please follow the instructions to install docker from \url{https://docs.docker.com/engine/install/}.

Importing the docker container can be done with the following command.

\begin{lstlisting}[language=bash]
  docker import historia.docker
\end{lstlisting}

The docker container may be run with the following command. \TODO{expose web port and swap with jupyter command}
\begin{lstlisting}[language=bash]
  docker run --memory="8G" --memory-swap="8G" --rm -it historia bash
\end{lstlisting}

All subsequent steps may be done through the web interface at a URL printed by the terminal window the docker command was run. This URL should start with \url{http://localhost:8080} and contain an encoded security token.  Opening this URL should show a Jupyter notebook.
\TODO{screenshot of jupyter notebook}


\paragraph{System Requirements} 
We have split the instructions so that a subset of the experiments may be run on a reasonable laptop and included full instructions if access to a server is available.
The instructions labeled "minimal resources" may be run on a reasonably modern laptop that has 8GB of ram in addition to ram used by other processes. 

Instructions labeled with "full resources" can be run on more powerful systems.  In order to utilize the full instructions, remove the following two arguments from the \codej{docker run} command: \codej{--memory="8G" --memory-swap="8G"}.  We used a server with a AMD EPYC 7763 64-Core Processor and 256GB of ram.  Running the full instructions on lower end systems will result in timeouts and out of memory errors.  Please note that sometimes the process will be killed with no memory related error message if not enough ram is available, this is simply a JVM/JNI limitation.


\section{Reproducing the Historia Results}

Each subsection here corresponds to a table in the evaluation section.  We have labeled the subsections first with the research question (\req{1} or \req{2}), the table number (Table 1, Table 2, Table 3), and finally, the resource requirements as described earlier (minimal resources or full resources).

\subsection{\req{1} - Table 1 - minimal resources}

\TODO{just disable one that OOMs and have some instructions to re-enable}

To run the experiments for the first table, open the terminal in the Jupyter notebook listed earlier and run the following commands:
\begin{lstlisting}[language=bash]
    cd home/bounder
    bash runExperiments.sh
\end{lstlisting}

The output will be printed to the screen in a log format.  Each row of Table 1 may be found labeled by ``Row'' followed by the row number and version (i.e. ``bug'' or ``fix'').  For example, the buggy version of \apGa is ``Row 1 bug'' and the fixed version is ``Row 1 fix''.  There will be several rows of text displaying the data from the table.  The output is labeled with ``actual:'' and may say ``Witnessed'', ``Timeout'', or ``Proven''.

\TODO{explain message counts etc}

\TODO{SM: explain how to compare flowdroid and infer}


\subsection{\req{2} - Table 2 - minimal resources}

\subsection{\req{2} - Table 3 - minimal resources}

\TODO{--Full resources}

\subsection{Running \req{1} (full)}

\TODO{}

\subsection{Running \req{2} (full)}

\TODO{}


\TODO{third priority is comparison with infer/flow}

\section{Running and Interpreting \toolname on Custom Inputs}
\TODO{second priority}

Historia may be run on arbitrary Android applications as long as an APK can be compiled in debug mode.  This is usually accomplished using the command \codej{./gradlew assembleDebug} but will vary from application to application. A location and safety property must be chosen ahead of time.  However, we recommend only writing \newls specifications as needed.

\paragraph{Running \toolname Through Jupyter}
The recommended way to run \toolname is using a Jupyter notebook.  This allows the inputs to the tool to be defined using the Scala data structures for input rather than JSON.

\TODO{give sample app to walk through this process}

\TODO{explain this process completely}

\TODO{explain counter examples}


\section{Developing for \toolname}
\TODO{fourth priority}

In this section, we explain the implementation of each technical contribution in \toolname.

\subsection{Running Unit Tests}

\TODO{this may need to go in later connecting formalism section}


\subsection{Application-Only Control-Flow Graph}

\TODO{}

\subsection{Message-History Program Logic (MHPL)}

\TODO{}

\subsection{Callback Control-Flow Temporal Logic (CBCFTL)}

\TODO{}

\subsection{Combining Abstract Message Histories with Callback Control Flow}

\TODO{}

\subsection{Optimizations}

\TODO{}

%======================


\bibliography{conference.short,bec.short}% main.short,

%\ifTR
%\clearpage
%\appendix
%\inputsection{appendix}
%\fi

\end{document}

%%%%old sections
%\input{decision-procedure}
